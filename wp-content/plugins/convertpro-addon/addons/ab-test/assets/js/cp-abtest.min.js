!function(l){var r="",t="",_="",o="",d="",u={init:function(){l("body"),l(".cp-api-integration-form");this._ready(),r=l("#cp-create-ab-test"),t=l(".create-test-link"),d=l(".cp-abtest-modal"),_=d.find(".save-ab-test"),o=d.find("select.select2-ex-dropdown"),messageWrap=d.find(".cp-notification-message .cp-error"),t.on("click",this._create),l(document).on("click",".update-ab-test-link",this._edit),l(document).on("click",".remove-test",this._remove),l(document).on("click",".cp-stop-test-action",this._stop),l(document).on("mouseup","body:not(#cp-edit-dropdown a)",this._closeEditPanel),l(document).on("change","select[name=cp_parent_style]",function(){messageWrap.html("").removeClass("cpro-open")}),l(document).on("click",".cp-style-title a",this._editTest),r.on("submit",this._submit),o.on("change",this._updateParentDropdown),l(document).on("click",".cp-ab-edit-settings",this._editSetting),l(document).on("cp_after_ab_test_created",this._refresh_html)},_editTest:function(t){var e=l(this),a=l("#cp-ab-edit-dropdown"),e=e.closest(".cp-ab-test-row"),s=e.data("test-id"),n=e.data("test-status"),e=e.data("props");a.data("test-id",s),a.data("props",e),"2"!=n&&u._edit(t)},_closeEditPanel:function(){l("#cp-ab-edit-dropdown").removeClass("cp-edit-show cp-edit-below cp-edit-above"),messageWrap.html("").removeClass("cpro-open"),l(".cp-ab-edit-settings").removeClass("active")},_editSetting:function(){var t=l(this),e=(2==t.data("completed")?(l("#cp-ab-edit-dropdown .update-ab-test-link").hide(),l("#cp-ab-edit-dropdown .cp-stop-test-action").hide()):(l("#cp-ab-edit-dropdown .update-ab-test-link").show(),l("#cp-ab-edit-dropdown .cp-stop-test-action").show()),l("#cp-ab-edit-dropdown")),a=t.closest(".cp-ab-test-row"),s=l(window),n=a.offset().top-s.scrollTop(),c=n+a.outerHeight(),i=e.outerHeight(!0),o="cp-edit-below",s=s.width()-(t.offset().left+t.outerWidth()+10),c=c-10,t=(l(".cp-ab-edit-settings").removeClass("active"),l("html").addClass("cp-edit-action-in"),t.data("ab-test")?e.addClass("cp-edit-ab-test"):e.removeClass("cp-edit-ab-test"),t.addClass("active"),i<n&&(o="cp-edit-above",c=n-i),e.addClass(o),e.css({top:c+"px",right:s+"px"}),e.addClass("cp-edit-show"),a.data("test-id")),n=a.data("props");e.data("test-id",t),e.data("props",n)},_updateParentDropdown:function(){var a,t=o.val(),s=r.find("select[name=cp_parent_style]"),e=s.val();messageWrap.html("").removeClass("cpro-open"),s.html(""),s.append('<option value="-1">'+cp_abtest.select+"</option>"),null!=t&&2<=t.length?(l(".cp-abtest-parent-wrap").show(),l.each(t,function(t,e){a=o.find("option[value="+e+"]").text(),s.append('<option value="'+e+'">'+a+"</option>")}),r.find("select[name=cp_parent_style] option[value="+e+"]").prop("selected",!0)):l(".cp-abtest-parent-wrap").hide()},_create:function(){var t=l(this).data("campaign"),e=l(this).data("settings"),a=r.find("select[name=cp_parent_style]");u.ajaxCall({action:"cp_get_remaining_popups",security:l("#cp-delete-test-nonce").val()},function(t){var a;"null"!=t&&(a="",l.each(t,function(t,e){a+='<option value="'+t+'">'+e+"</option>"}),o.html(a))},function(t){console.log(t)}),l(".cp-abtest-parent-wrap").hide(),a.html(""),a.append('<option value="-1">'+cp_abtest.select+"</option>"),_.data("campaign",t),d.find(".cp-info-section").html(e),_.text(cp_abtest.create_test).data("action","cp_create_ab_test"),d.find(".cp-dashboard-modal-title").text(cp_abtest.create_new_test),r.find("#cp-test-sdate").val(""),r.find("#cp-test-edate").val(""),r.find("#test_title").val(""),o.find("option").prop("selected",!1),r.find("input[name=cp_winner_check]").prop("checked",!1),o.cpselect2({placeholder:cp_abtest.select_styles}),d.addClass("cp-show"),l(".cp-md-overlay").addClass("cp-show"),d.find(".cp-save-animate-container").removeClass("cp-zoomOut").addClass(" cp-animated cp-zoomIn")},_edit:function(t){t.preventDefault();var n,c=l("#cp-ab-edit-dropdown").data("props"),t=l("#cp-ab-edit-dropdown").data("test-id"),e="<div class='cp-abtest-block'><input type='hidden' id='cp-test-id' value='"+t+"'></div>",i=r.find("select[name=cp_parent_style]");o.html(""),u.ajaxCall({action:"cp_get_remaining_popups",test_id:t,security:l("#cp-delete-test-nonce").val()},function(t){var a,s;"null"!=t&&(s=a="",l.each(t,function(t,e){s=-1!=c.sel_styles.indexOf(parseInt(t))?'selected="selected"':"",a+='<option value="'+t+'" '+s+">"+e+"</option>"}),o.html(a),i.html(""),i.append('<option value="-1">'+cp_abtest.select+"</option>"),d.find(".cp-dashboard-modal-title").text(cp_abtest.edit_test),r.find("#cp-test-sdate").val(c.start_date),r.find("#cp-test-edate").val(c.end_date),r.find("#test_title").val(c.name),"on"==c.winner_style?r.find("input[name=cp_winner_check]").attr("checked","checked"):r.find("input[name=cp_winner_check]").prop("checked",!1),""==c.name||r.find("#test_title").parent().hasClass("has-input")||r.find("#test_title").parent().addClass("has-input"),_.text(cp_abtest.update_test).data("action","cp_update_ab_test"),c.sel_styles.length<2?l(".cp-abtest-parent-wrap").hide():l(".cp-abtest-parent-wrap").show(),l.each(c.sel_styles,function(t,e){o.find("option[value="+e+"]").attr("selected","selected"),n=o.find("option[value="+e+"]").text(),i.append('<option value="'+e+'">'+n+"</option>")}),o.cpselect2({placeholder:cp_abtest.select_styles}),""!=c.parent_style&&i.find("option[value="+c.parent_style+"]").attr("selected","setTimeout"),d.find(".cp-style-list").after(e),d.addClass("cp-show"),l(".cp-md-overlay").addClass("cp-show"),d.find(".cp-save-animate-container").removeClass("cp-zoomOut").addClass(" cp-animated cp-zoomIn"),u._closeEditPanel())},function(t){console.log(t)})},_submit:function(t){t.preventDefault();var t=r.find("#test_title").val(),e=r.find(".save-ab-test").data("campaign"),a=r.find("#cp-test-sdate").val(),s=r.find("#cp-test-edate").val(),n=r.find(".save-ab-test").data("action"),c=r.find("#cp-test-id").val(),i=r.find("select[name=cp_styles]").val(),o=r.find("select[name=cp_parent_style]").val(),d=r.find("input[name=cp_winner_check]:checked").length,p=cp_abtest.two_popups;return null==i?(messageWrap.html(cp_abtest.atleast_one_design).addClass("cpro-open"),!1):i.length<2?(messageWrap.html(p).addClass("cpro-open"),!1):-1==o?(messageWrap.html(cp_abtest.parent_style).addClass("cpro-open"),!1):(_.text("Saving..."),void u.ajaxCall({action:n,test_name:t,test_id:c,styles:i,campaign:e,start_date:a,end_date:s,cp_parent_style:o,cp_winner_check:0==d?"off":"on",security:l("#cp-save-ab-test-nonce").val()},u._submitCompleted,function(t){console.log(t)}))},_submitCompleted:function(t){var e=l(".cp-accordion-section-content"),a=r.find(".save-ab-test").data("action"),s=r.find("#cp-test-id").val();if(void 0!==t.data&&void 0!==t.data.message){var n=t.data.message;if(!0!==t.data.success)return messageWrap.html(n).addClass("cpro-open"),!1;""!=t.data.html&&("cp_update_ab_test"==a?(e.find(".cp-ab-test-row[data-test-id="+s+"]").replaceWith(t.data.html),l(".no-tests").addClass("cp-hidden")):(0==e.find(".cp-ab-test-row:last-child").length?(e.addClass("open"),l(".no-tests").addClass("cp-hidden"),e.find(" .cp-abtest-row").html(t.data.header_html),e.find(" .cp-abtest-row")):e.find(" .cp-ab-test-row:last-child")).after(t.data.html)),setTimeout(function(){_.text(cp_abtest.saved),_.append('<span class="dashicons-yes dashicons"></span>')},300),setTimeout(function(){messageWrap.html("").removeClass("cpro-open"),l(".cp-cancel-btn").trigger("click")},600),jQuery(document).trigger("cp_after_ab_test_created",[s])}},_ready:function(){void 0!==l().datetimepicker&&(l("#cp-test-sdate").datetimepicker({format:"DD/MM/YYYY",minDate:"now"}),l("#cp-test-edate").datetimepicker({useCurrent:!1,format:"DD/MM/YYYY"}),l("#cp-test-sdate").on("dp.change",function(t){l("#cp-test-edate").data("DateTimePicker").minDate(t.date)}),l("#cp-test-edate").on("dp.change",function(t){l("#cp-test-sdate").data("DateTimePicker").maxDate(t.date)}))},_stop:function(){if(!confirm(cp_abtest.stop_test))return!1;var t=l("#cp-ab-edit-dropdown").data("test-id");u.ajaxCall({action:"cp_update_ab_test_status",test_id:t,status:2,security:l("#cp-delete-test-nonce").val()},function(t){location.reload()},function(t){console.log(t)})},_remove:function(){if(!confirm(cp_abtest.delete_test))return!1;l(this);var t=l("#cp-ab-edit-dropdown").data("test-id"),a=l(".cp-ab-test-row[data-test-id="+t+"]");a.addClass("cp-delete"),u.ajaxCall({action:"cp_del_ab_test",test:t,security:l("#cp-delete-test-nonce").val()},function(t){void 0!==t.data&&void 0!==t.data.test_id&&(a.addClass("cp-delete-wrap"),setTimeout(function(){var t=a.closest(".cp-accordion-section-content"),e=t.find(".cp-ab-test-row").length;t.find(".cp-abtest-row");a.remove(),1==e&&(l(".no-tests").removeClass("cp-hidden"),t.removeClass("open")),u._closeEditPanel()},400))},function(t){console.log(t)})},_refresh_html:function(){u.ajaxCall({action:"cp_refresh_html",cp_nonce:cp_abtest.ajax_nonce},function(t){console.log(t)},function(t){console.log(t)})},serializeFormJSON:function(t){var e={},t=t.serializeArray();return l.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},ajaxCall:function(t,e,a){l.ajax({data:t,action:t.action,url:cp_ajax.url,success:e,error:a,type:"POST",dataType:"JSON"})}};l(document).ready(function(){google.charts.load("current",{packages:["corechart"]}),l(document).on("click",".cp-ab-test-analytics",function(t){t.preventDefault();var t=l("#cp-ga-abtest-modal"),e=(l(this).data("style"),l(this).data("ab-test"));if(t.addClass("cp-show"),l(".cp-md-overlay").addClass("cp-show"),t.find(".cp-save-animate-container").removeClass("cp-zoomOut").addClass(" cp-animated cp-zoomIn"),l(".cp-ga-abtest-filter").data("style",e),0!=l("#cp_ga_chart_div").length){var t=e,e=void 0,t=l.ajax({url:cp_ajax.url,method:"post",data:{action:"cp_get_ab_ga_data",test_id:t,filter:e,security:jQuery("#cp_get_ab_ga_data_chart_nonce").val()},dataType:"json",async:!1}).responseText,a=JSON.parse(t),s=new google.visualization.DataTable;for(s.addColumn("date","X"),i=0;i<a.cols.length;i++)s.addColumn("number",a.cols[i]);for(i=0;i<a.rows.length;i++)a.rows[i][0]=new Date(a.rows[i][0]);s.addRows(a.rows),new google.visualization.LineChart(document.getElementById("cp_ga_chart_div")).draw(s,{title:"Analytics",width:640,height:300,hAxis:{title:"Date"},vAxis:{title:"Conversions"}}),setTimeout(function(){l(".cp-ga-filter-wrap .cp-ga-abtest-filter").removeClass("cp-show")},200)}})}),l(function(){u.init()})}(jQuery);