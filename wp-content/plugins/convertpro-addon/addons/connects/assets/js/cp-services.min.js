!function(d){var c="",r=new Array,o="",p=new Array,s="",l="",u="",_="",h="",g="",t="",v="",f="",w="",y=(allSteps="",currentStep="",currentStepIndex="",loader="",isValidated=!1,isEmailFieldAdded=!1,style_id=0,noMapping=!1,modal="",whr_to_find="",insyncSource="",test_conn_btn="",{init:function(){var e=d("body");d(".cp-api-integration-form");s=d(".cp-md-modal-content button.cp-authenticate-connects"),l=d(".cp-md-modal-content button.cp-add-new-account"),u=d(".cp-md-modal-content button.cp-use-existing-account"),_=d(".cp-md-modal-content button.cp-next-connects"),h=d(".cp-md-modal-content button.cp-back-connects"),g=d(".cp-md-modal-content button.cp-save-connects"),t=d(".cp-md-content .cp-response-wrap"),v=d(".cp-add-new-account-form"),f=d(".cp-account-list-form"),w=d(".cp-api-integration-form"),mappingFrm=d(".cp-account-mapping-form"),allSteps=d(".cp-md-modal-content .cp-md-steps"),currentStep=d(".cp-md-modal-content .cp-md-steps li.cp-present-step"),loader=d(".cp-md-modal").find(".cp-md-loader"),isValidated=!1,isEdit=!1,style_id=d("#cp_style_id").val(),modal=d("#cp-md-modal-1"),whr_to_find=d(".cp-md-info-wrap"),test_conn_btn=d(".cp-test-connection"),whr_to_find.css("visibility","hidden"),e.on("click",".cp-md-trigger",this._serviceSelected),e.on("cp-invoke","select[name=cp_select_account]",this._serviceChange),e.on("click",".cp-remove-account",this._removeAccount),e.on("click",".cp-change-account",this._changeAccount),e.on("click",".cp-edit-account",this._changeAccount),e.on("click",".cp-customizer-remove-account",this._deleteAccount),e.on("click",".cp-md-close",this._removeAssets),l.on("click",this._addAccount),u.on("click",this._useExistingAccount),s.on("click",this._authenticateCredentials),h.on("click",this._backStepButton),_.on("click",this._nextStepButton),g.on("click",this._saveMeta),d(document).on("change",".cp-is_form-wrap select[name=is_form]",this._changeMauticForm),d(document).on("change",".cp-is_account_type-wrap select[name=is_account_type]",this._changeGetResponseAccountType),d(document).on("click",".cp-save",this._checkMapping),d(document).on("click",".cp-mapping-notice .error-close",this._closeWarning),d(document).on("change",".cp-mapping-fields select",this._mappingFieldChange),this._openPopup(),d(document).on("click",".cp-test-connection",this._testConnection)},_closeWarning:function(){d(".cp-mapping-notice").html("")},_checkMapping:function(){var e=d("#connect input[name=cp_mapping]").val(),i=new Array,t=new Array,n=(new Array,new Array);if(d(".cp-mapping-notice").html(""),"-1"!=e){e=JSON.parse(e),d(".cp-form-input-field").each(function(e,t){d(this).hasClass("cp-email")||i.push(d(this).attr("name"))}),t=i,d.each(e,function(e,t){t=t.name;-1===t.indexOf("{input}")&&n.push(t)});for(var a=0;a<i.length;a++)for(var c=0;c<n.length;c++){var o=n[c];(_name=(_name=o.replace("cp_mapping{","")).replace("}",""))==i[a]&&-1<(index=t.indexOf(i[a]))&&t.splice(index,1)}if(0<t.length){for(var s="",e=cp_services.mapping_notice,r=d(".cp-connect-integration-meta .cp-change-account").data("service-title"),p=d(".cp-connect-integration-meta .cp-active-title").text(),a=0;a<t.length;a++)s+='<div class="cp-error-wrap"><span class="cp-error-field">'+d(".cp-form-input-field[name="+t[a]+"]").data("placeholder")+"</span></div>";e=(e=e.replace("##mailer_name##",r)).replace("##account_name##",p),d(".cp-mapping-notice").html(d("<div>",{class:"cp-mapping-notice-wrap"})),d(".cp-mapping-notice-wrap").html(d("<div>",{class:"cp-mapping-notice-head"}).append(d("<span>").html(e))),d(".cp-mapping-notice-wrap").append(d("<div>").append(s+'<span class="error-close">&times;<span>'))}}},_changeMauticForm:function(){var e=d(this).val();""!=e&&"-1"!=e?"api"==e?(d(".cp-public_key-wrap").show(),d(".cp-secret_key-wrap").show(),d(".cp-form_id-wrap").hide(),d(".cp-mautic_username-wrap").hide(),d(".cp-mautic_password-wrap").hide()):"m_up"==e?(d(".cp-public_key-wrap").hide(),d(".cp-secret_key-wrap").hide(),d(".cp-form_id-wrap").hide(),d(".cp-mautic_username-wrap").show(),d(".cp-mautic_password-wrap").show()):(d(".cp-public_key-wrap").hide(),d(".cp-secret_key-wrap").hide(),d(".cp-form_id-wrap").show(),d(".cp-mautic_username-wrap").hide(),d(".cp-mautic_password-wrap").hide()):(d(".cp-public_key-wrap").hide(),d(".cp-secret_key-wrap").hide(),d(".cp-form_id-wrap").hide(),d(".cp-mautic_username-wrap").hide(),d(".cp-mautic_password-wrap").hide())},_changeGetResponseAccountType:function(){var e=d(this).val();""!=e&&"-1"!=e&&("gr_com"==e||"gr_pl"==e)?d(".cp-getresponse_domain_name-wrap").show():d(".cp-getresponse_domain_name-wrap").hide()},_openPopup:function(){var e=y._getParameterByName("open_connects"),t=y._getParameterByName("account"),i=y._getParameterByName("service");"true"==e&&"null"!=t&&("mautic"==i&&d(".cp-connect-service-mautic").trigger("click"),"verticalresponse"==i&&d(".cp-connect-service-verticalresponse").trigger("click"),setTimeout(function(){y._startSettingsLoading(),w.find("input[type=radio][value="+t+"]").prop("checked",!0),_.trigger("click")},200))},_getParameterByName:function(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},_serviceChange:function(){noMapping=!0,y._updateErrorMsg(""),y._startSettingsLoading(),isEdit=!1,y._updateSteps(1);var e=d(this).val(),t=d(this).find("option[value="+e+"]").data("title"),i=cp_services.image_base_url+e+".png";modal.find(".cp-md-modal-header img").attr("src",i),modal.find(".cp-md-modal-title").text(t+" Integration Setup"),-1==e||null==e?y._updateErrorMsg(cp_services.wrong):(o=e,y.ajaxCall({action:"cppro_get_assets_data",service:e,addon_security:cpAddonModules.ajax_nonce},y._assetsDataComplete),f.find("input[name=cp-integration-service]").val(o),"mailpoet"==e||"mymail"==e||"fluentcrm"==e?(w.hide(),f.show(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.hide(),u.hide(),_.show(),h.hide(),g.hide(),s.hide(),y._getLists(e)):(w.show(),_.show(),f.hide(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.show(),u.hide(),h.hide(),g.hide(),s.hide(),y.ajaxCall({action:"cppro_render_service_accounts",service:e,selected:"",addon_security:cpAddonModules.ajax_nonce},y._serviceSelectedComplete),y.ajaxCall({action:"cppro_render_service_settings",service:e,addon_security:cpAddonModules.ajax_nonce},y._serviceInputFieldsComplete)))},_removeAssets:function(){ConvertPlugServicesTrigger.removeHook("cp-service-getlist-click"),ConvertPlugServicesTrigger.removeHook("cp-service-list-validate"),d("script.cp-mailer-"+o+"-js").remove(),d("script.cp-mailer-"+o+"-css").remove(),modal.removeClass("cp-md-show")},_getisValidated:function(){return isValidated},_setisValidated:function(e){isValidated=e},_updateSteps:function(e){currentStepIndex=e,allSteps.find("li").removeClass("cp-present-step"),allSteps.find("li:nth-child("+e+")").removeClass("cp-past-step cp-future-step").addClass("cp-present-step"),allSteps.find("li:gt("+(e-1)+")").removeClass("cp-past-step").addClass("cp-future-step"),allSteps.find("li:lt("+(e-1)+")").removeClass("cp-future-step").addClass("cp-past-step"),d(".cp-md-modal .cp-md-contents").removeClass("cp-step-1 cp-step-2 cp-step-3"),d(".cp-md-modal .cp-md-contents").addClass("cp-step-"+e)},_changeAccount:function(){isEdit=!0;var e=d(this).data("source"),e=(void 0!==e&&(insyncSource=e,noMapping=!0),y._updateErrorMsg(""),modal.addClass("cp-md-show"),y._startSettingsLoading(),y._updateSteps(1),d(this).data("service")),t=d(this).data("account"),i=d(this).data("service-title");o=e,f.find("input[name=cp-integration-service]").val(o),f.find("input[name=cp-integration-account-slug]").val(t),f.find("input[name=cp-integration-account-slug]").data("account-title",t),modal.find(".cp-md-modal-title").text(i+" Integration Setup"),modal.find(".cp-md-modal-header img").attr("src",cp_services.image_base_url+e+".png"),"aweber"===e&&0===modal.find(".cp-aweber-notice").length&&modal.find(".cp-integration-name").before('<p class="cp-aweber-notice">Note: We have upgraded to Aweber 2.0 API. Please remove existing Aweber connections and reconnect for the changes to take effect.</p>'),y.ajaxCall({action:"cppro_get_assets_data",service:e,addon_security:cpAddonModules.ajax_nonce},y._assetsDataComplete),"mailpoet"==t||"mymail"==t||"fluentcrm"==t?(w.hide(),f.show(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.hide(),u.hide(),_.show(),h.hide(),g.hide(),s.hide(),y._getLists(t)):(w.show(),f.hide(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.show(),u.hide(),h.hide(),g.hide(),s.hide(),_.show(),y.ajaxCall({action:"cppro_render_service_accounts",service:e,selected:t,addon_security:cpAddonModules.ajax_nonce},y._serviceSelectedComplete),y.ajaxCall({action:"cppro_render_service_settings",service:e,addon_security:cpAddonModules.ajax_nonce},y._serviceInputFieldsComplete))},_deleteAccount:function(){var e,t,i=d(this),n=i.data("account-name");0<i.data("isassociated")?(e=cp_services.cant_delete.replace("##account_name##",n),y._updateErrorMsg(e)):(e=cp_services.confirm_delete.replace("##account_name##",n),confirm(e)&&(y._startSettingsLoading(),i.closest(".cp-customizer-radio").find("input").attr("data-selected-account"),n=i.data("account-slug"),e=i.data("account-name"),t=i.data("account-type"),y.ajaxCall({action:"cppro_delete_service_account",account:n,addon_security:cpAddonModules.ajax_nonce,account_name:e,account_type:t},function(e){JSON.parse(e).error||(i.closest(".cp-service_accounts-wrap").empty(),y.ajaxCall({action:"cppro_render_service_accounts",service:o,selected:"",addon_security:cpAddonModules.ajax_nonce},y._serviceSelectedComplete))})))},_removeAccount:function(){confirm(cp_services.confirm_remove)&&(y._startSettingsLoading(),d("#connect input[name=cp_mapping]").val(-1),d("#connect input[name=cp_connect_settings]").val(-1),y.ajaxCall({action:"cppro_save_meta_settings",style_id:style_id,cp_mapping:-1,cp_taxonomy:-1,addon_security:cpAddonModules.ajax_nonce},y._metaDeleteComplete))},_metaDeleteComplete:function(e){e=JSON.parse(e);e.error?(y._finishSettingsLoading(),y._updateErrorMsg(e.error)):(d("#connect .cp-connect-integration-meta").addClass("cp-hidden"),d("#connect .cp-connect-integration-wrap").removeClass("cp-hidden"),y._finishSettingsLoading(),d(".cp-md-close").trigger("click"))},_backStepButton:function(){var t,e;y._updateErrorMsg(""),y._startSettingsLoading(),2==currentStepIndex?(y._useExistingAccount(),e=(t=d(".cp-customizer-radio")).find("input:checked").val(),y.ajaxCall({action:"cppro_render_service_accounts",service:o,selected:null==typeof e?"":e,addon_security:cpAddonModules.ajax_nonce},function(e){var e=JSON.parse(e);e.error?(0==e.account_count?(y._addAccount(),u.hide()):(_.addClass("cp-disable"),w.find(".cp-api-selection-list").html("")),y._updateErrorMsg(e.error)):(y._updateErrorMsg(""),_.removeClass("cp-disable"),w.find(".cp-api-selection-list").html(e.html),0<t.length&&0<(e=t.find("input:checked")).length&&e.attr("data-selected-account","active"),1==t.length&&t.find("input").attr("checked","checked"))})):(y._updateSteps(2),f.show(),w.hide(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.hide(),u.hide(),_.show(),h.show(),g.hide(),s.hide()),y._finishSettingsLoading()},_nextStepButton:function(){_.hasClass("cp-disable")||(y._updateErrorMsg(""),1==currentStepIndex?y._connectionChanged():y._cpGenerateFieldsMapping())},_saveMeta:function(){var e,t,i,n;g.hasClass("cp-disable")||(y._startSettingsLoading(),ConvertPlugServicesTrigger.removeHook("cp-service-getlist-click"),ConvertPlugServicesTrigger.removeHook("cp-service-list-validate"),t=window.location.href,e="","true"==y._getParameterByName("open_connects")&&(e=t.replace("&open_connects=true",""),setTimeout(function(){history.pushState({},null,e)},200)),1==noMapping?(t=JSON.stringify(f.serializeArray()),d("input[name=cp_connection_values]").val(t),d("select[name=cp_select_account]").addClass("cp-hidden"),y._saveInSync()):(t=JSON.stringify(mappingFrm.serializeArray()),i=JSON.stringify(f.serializeArray()),d("#connect input[name=cp_mapping]").val(t),d("#connect input[name=cp_connect_settings]").val(i),n=f.find("input[name=cp-integration-service]").val(),y.ajaxCall({action:"cppro_save_meta_settings",style_id:style_id,cp_mapping:t,cp_taxonomy:i,service:n,addon_security:cpAddonModules.ajax_nonce},y._metaSavedComplete)),d(document).trigger("cpro_after_save_mapping",[mappingFrm.serializeArray(),f.serializeArray()]))},_saveInSync:function(){var e,t=f.find("input[name=cp-integration-account-slug]").val(),i=f.find("input[name=cp-integration-service]").val(),n=d(".cp-insync-content-wrap .cp_connection_row").find(".cp-connect-integration-meta .cp-meta-wrap img"),a=f.find("input[name=cp-integration-account-slug]").data("account-title");"mailpoet"!=i&&"mymail"!=i&&"fluentcrm"!=i||(a="mailpoet"==i?"MailPoet":"mymail"==i?"MyMail":"FluentCRM"),e=cp_services.image_base_url+i+".png",n.attr("src",e),d(".cp-insync-content-wrap .cp_connection_row .cp-connect-integration-meta").removeClass("cp-hidden"),d(".cp-insync-content-wrap .cp_connection_row .cp-connect-integration-wrap").addClass("cp-hidden"),d(".cp-insync-content-wrap .cp_connection_row").find(".cp-active-title").html(a),d(".cp-insync-content-wrap .cp_connection_row .cp-change-account").attr("data-account",t),d(".cp-insync-content-wrap .cp_connection_row .cp-change-account").attr("data-service",i),d(".cp-insync-content-wrap .cp_connection_row .cp-change-account").attr("data-service-title",i),d(".cp-insync-content-wrap .cp_connection_row .cp-disconnect-account").attr("data-account",t),y._finishSettingsLoading(),d(".cp-md-close").trigger("click")},_metaSavedComplete:function(e){var t,i,n,a,c,e=JSON.parse(e);e.error?(y._finishSettingsLoading(),y._updateErrorMsg(e.error)):(t=f.find("input[name=cp-integration-account-slug]").val(),i=f.find("input[name=cp-integration-service]").val(),n=d("#connect").find(".cp-connect-integration-meta .cp-meta-wrap img"),a="",c=f.find("input[name=cp-integration-account-slug]").data("account-title"),e.has_test_connection?(d(".cp-test-connection").removeClass("cp-hidden"),d(".cp-test-connection").data("account",t),d(".cp-test-connection").data("service",i)):d(".cp-test-connection").addClass("cp-hidden"),"mailpoet"!=i&&"mymail"!=i&&"fluentcrm"!=i||(c="mailpoet"==i?"MailPoet":"mymail"==i?"MyMail":"FluentCRM"),a=cp_services.image_base_url+i+".png",n.attr("src",a),d("#connect .cp-connect-integration-meta").removeClass("cp-hidden"),d("#connect .cp-connect-integration-wrap").addClass("cp-hidden"),d("#connect").find(".cp-active-title").html(c),d("#connect .cp-change-account").data("account",t),d("#connect .cp-change-account").data("service",i),d("#connect .cp-change-account").data("service-title",i),d("#connect .cp-remove-account").data("account",t),y._finishSettingsLoading(),d(".cp-md-close").trigger("click")),d("#connect").scrollTop(0)},_mappingFieldChange:function(){var e=d(this).val(),t=d(this).closest("tr").find("input[type=text]");"custom_field"==e?t.show():t.hide()},_serviceSaveComplete:function(e){e=JSON.parse(e);e.error?(y._finishSettingsLoading(),y._updateErrorMsg(e.error)):(y._startSettingsLoading(),f.find("input[name=cp-integration-account-slug]").val(e.term_id),f.find("input[name=cp-integration-service]").val(o),w.hide(),f.show(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.hide(),u.hide(),_.show(),h.show(),g.hide(),s.hide(),y._updateSteps(2),y._getLists(e.term_id))},_getLists:function(e){f.find("input[name=cp-integration-account-slug]").val(e),y.ajaxCall({action:"cppro_render_service_fields",account:e,isEdit:isEdit,style_id:style_id,noMapping:noMapping,src:insyncSource,addon_security:cpAddonModules.ajax_nonce},y._serviceFieldsComplete)},_authenticateCredentials:function(){y._updateErrorMsg("");var e=y.serializeFormJSON(v),t=window.location.href.split("#")[0];y._startSettingsLoading(),y.ajaxCall({action:"cppro_connect_service",service:o,fields:e,currentUrl:t,addon_security:cpAddonModules.ajax_nonce},y._authenticateCredentialsComplete)},_authenticateCredentialsComplete:function(e){var t,i,e=JSON.parse(e),n=y.serializeFormJSON(v);if(account_title=v.find("input[name=service_account]").val(),e.error)return y._finishSettingsLoading(),y._updateErrorMsg(e.error),!1;f.find("input[name=cp-integration-account-slug]").data("account-title",account_title),_.removeClass("cp-disable"),"mautic"==o?"form"==(t=v.find(".cp-api-fields select[name=is_form]").val())||"m_up"==t?y.ajaxCall({action:"cppro_save_service_settings",serviceData:n,service:o,addon_security:cpAddonModules.ajax_nonce},y._serviceSaveComplete):(i=e.data.redirect_url,window.location=i):"verticalresponse"==o?(i=e.data.url,window.location=i):y.ajaxCall({action:"cppro_save_service_settings",serviceData:n,service:o,addon_security:cpAddonModules.ajax_nonce},y._serviceSaveComplete)},_addAccount:function(){y._updateErrorMsg(""),s.show(),u.show(),_.hide(),l.hide(),g.hide(),l.hide(),w.hide(),f.hide(),v.show(),whr_to_find.css("visibility","visible"),mappingFrm.hide()},_useExistingAccount:function(){y._startSettingsLoading(),w.show(),f.hide(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.show(),u.hide(),_.show(),h.hide(),g.hide(),s.hide(),y._updateSteps(1),y._updateErrorMsg(""),y._finishSettingsLoading()},_serviceSelected:function(){y._updateErrorMsg(""),y._startSettingsLoading(),isEdit=!1,y._updateSteps(1);var e=d(this).find(".cp-connect-service-list").data("service"),t=d(this).find(".cp-services-title").data("title"),i=d(this).find("img").attr("src");modal.find(".cp-md-modal-header img").attr("src",i),modal.find(".cp-md-modal-title").text(t+" Integration Setup"),-1==e||null==e?y._updateErrorMsg(cp_services.wrong):(o=e,y.ajaxCall({action:"cppro_get_assets_data",service:e,addon_security:cpAddonModules.ajax_nonce},y._assetsDataComplete),f.find("input[name=cp-integration-service]").val(o),"mailpoet"==e||"mymail"==e||"fluentcrm"==e?(w.hide(),f.show(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.hide(),u.hide(),_.show(),h.hide(),g.hide(),s.hide(),y._getLists(e)):(w.show(),_.show(),f.hide(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.show(),u.hide(),h.hide(),g.hide(),s.hide(),y.ajaxCall({action:"cppro_render_service_accounts",service:e,selected:"",addon_security:cpAddonModules.ajax_nonce},y._serviceSelectedComplete),y.ajaxCall({action:"cppro_render_service_settings",service:e,addon_security:cpAddonModules.ajax_nonce},y._serviceInputFieldsComplete)))},_assetsDataComplete:function(e){var t,e=JSON.parse(e);0==e.error&&(t=(e=d("<div>"+e.assets+"</div>")).find("link.cp-mailer-"+o+"-css"),0<(e=e.find("script.cp-mailer-"+o+"-js")).length&&(d("script.cp-mailer-"+o+"-js").remove(),d("html").append(e)),0<t.length)&&(d("script.cp-mailer-"+o+"-css").remove(),d("head").append(t))},_serviceSelectedComplete:function(e){var t,e=JSON.parse(e);d(".cp-md-info-wrap a").attr("href",e.url),e.error?0==e.account_count?(y._addAccount(),u.hide()):(_.addClass("cp-disable"),w.find(".cp-api-selection-list").html("")):(y._updateErrorMsg(""),_.removeClass("cp-disable"),w.find(".cp-api-selection-list").html(e.html),0<(e=d(".cp-customizer-radio")).length&&0<(t=e.find("input:checked")).length&&t.attr("data-selected-account","active"),1==e.length&&e.find("input").attr("checked","checked")),y._finishSettingsLoading()},_connectionChanged:function(){mappingFrm.find(".cp-success-msg").remove(),y._startSettingsLoading();var e=d(".cp-api-integration-form").find(".cp-customizer-radio input:checked"),t=d(".cp-api-integration-form").find(".cp-customizer-radio input:checked").data("account-name");e.length<1?(y._updateErrorMsg(cp_services.select_account),y._finishSettingsLoading()):(e=e.val(),f.find("input[name=cp-integration-account-slug]").data("account-title",t),isEdit=isEdit&&(noMapping?d(".cp-save-"+insyncSource+"-form .cp-edit-account"):d("#connect .cp-change-account")).data("account")==e,y._getLists(e))},_tooltipInit:function(){d(".bsf-has-tip, .has-tip").each(function(e,t){var t=void 0!==($tip=d(t)).attr("data-attribute")?$tip.attr("data-attribute"):"title",i=void 0!==$tip.attr("data-offset")?$tip.attr("data-offset"):10,n=void 0!==$tip.attr("data-position")?$tip.attr("data-position"):"top",a=void 0!==$tip.attr("data-trigger")?$tip.attr("data-trigger"):"hover,focus",c=void 0!==$tip.attr("data-classes")?"tip "+$tip.attr("data-classes"):"tip";$tip.frosty({className:c,attribute:t,offset:i,position:n,trigger:a})})},_serviceFieldsComplete:function(e){var e=JSON.parse(e),t=f.find(".cp-new-account-fields");e.error?y._updateErrorMsg(e.error):(y._tooltipInit(),ConvertPlugServicesTrigger.triggerHook("cp-service-getlist-click",y),y._updateErrorMsg(""),y._updateSteps(2),f.show(),w.hide(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),l.hide(),u.hide(),_.show(),h.show(),g.hide(),s.hide(),t.html(e.html),c=e.mapping_fields,"mailpoet"!=o&&"mymail"!=o&&"fluentcrm"!=o||h.hide(),noMapping&&(g.show(),_.hide())),y._finishSettingsLoading()},_cpGenerateFieldsMapping:function(){mappingFrm.find(".cp-success-msg").remove();var n=0,a=0;isEmailFieldAdded=!1,ConvertPlugServicesTrigger.triggerHook("cp-service-list-validate",y),isValidated?y._updateErrorMsg(isValidated):(w.hide(),f.hide(),v.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.show(),l.hide(),u.hide(),_.hide(),h.show(),g.show(),s.hide(),"mailpoet"!=o&&"mymail"!=o&&"fluentcrm"!=o||h.hide(),r=new Array,p=new Array,d(".cp-form-input-field").each(function(){d(this).hasClass("cp-email")&&(isEmailFieldAdded=!0);var e=d(this).attr("name").replace(/[^a-z0-9\s]/gi,"").toLowerCase(),t=!0;for(i=0;i<c.length;i++)c[i].toLowerCase()==e&&(t=!(r[a]={name:c[i],value:d(this)}),a++);t&&"paramemail"!=e&&(p[n]={name:"custom_field",value:d(this)},n++)}),y._cpAllocateFieldsMapping(),y._updateSteps(3))},_updateErrorMsg:function(e){t.html(e),""!=e?t.addClass("cp-response-failure"):t.removeClass("cp-response-failure")},_cpAllocateFieldsMapping:function(){var e,t="",n=mappingFrm.find(".cp-mapping-fields").find("table tbody");if(n.html(""),g.removeClass("cp-disable"),0<r.length||0<p.length){for(n.append("<tr><th>"+cp_services.cp_fields+"</th><th>"+cp_services.mailer_fields+"</th></tr>"),i=0;i<r.length;i++){n.append(d("<tr>"));var a=r[i].value.attr("name"),c="<label>"+r[i].value.attr("data-placeholder")+"</label>",o=n.find("tr:eq("+(i+1)+")"),t=y._getMappingOptionsHTML(a);o.append(d("<td>").append(c)),o.append(d("<td>").append(d("<select>").attr("name","cp_mapping{"+a+"}").append(d(t)))),o.append(d("<td>").append(d("<input>",{type:"text",val:"",placeholder:cp_services.placeholder,name:"cp_mapping{"+a+"}{input}"})))}for(e=r.length+p.length,k=0,j=i;j<e;j++,k++){n.append(d("<tr>"));a=p[k].value.attr("name"),c="<label>"+p[k].value.attr("data-placeholder")+"</label>",o=n.find("tr:eq("+(j+1)+")");t=y._getMappingOptionsHTML(""),o.append(d("<td>").append(c)),o.append(d("<td>").append(d("<select>").attr("name","cp_mapping{"+a+"}").append(d(t)))),o.append(d("<td>").append(d("<input>",{type:"text",val:"",class:"",id:"",name:"cp_mapping{"+a+"}{input}"})))}if(isEdit){var s=JSON.parse(d("#connect input[name=cp_mapping]").val());for(m=0;m<s.length;m++)n.find("select[name='"+s[m].name+"']").val(s[m].value),n.find("input[name='"+s[m].name+"']").val(s[m].value),"custom_field"==s[m].value?n.find("input[name='"+s[m].name+"{input}']").show():n.find("input[name='"+s[m].name+"{input}']").hide()}isEmailFieldAdded||y._updateErrorMsg(cp_services.no_email)}else 1==d(".cp-form-input-field").length?(d(".cp-form-input-field").hasClass("cp-email")?mappingFrm.find(".cp-mapping-fields").after(d("<div/>").addClass("cp-success-msg").append("<span/>").text(cp_services.only_email)):y._updateErrorMsg(cp_services.no_email),g.removeClass("cp-disable")):(y._updateErrorMsg(cp_services.no_input),g.addClass("cp-disable"))},_getMappingOptionsHTML:function(e){var t,i="",n=0;if(void 0!==e){for(i+='<option value="-1">'+cp_services.select_option+"</option>",n=0;n<c.length;n++)t=e.toLowerCase()==c[n].toLowerCase()?' selected="selected" ':"",i+='<option value="'+c[n]+'" '+t+">"+c[n]+"</option>";i+='<option value="custom_field">'+cp_services.custom_field+"</option>"}return i},serializeFormJSON:function(e){var t={},e=e.serializeArray();return d.each(e,function(){t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},ajaxCall:function(e,t){d.ajax({data:e,action:e.action,url:cp_services.url,success:t,method:"post"})},_startSettingsLoading:function(e){loader.removeClass("cp-hidden")},_finishSettingsLoading:function(){loader.addClass("cp-modal-loaded"),setTimeout(function(){loader.addClass("cp-hidden"),loader.removeClass("cp-modal-loaded")},300)},_serviceInputFieldsComplete:function(e){var e=JSON.parse(e),t=v.find(".cp-new-account-fields");e.error?y._updateErrorMsg(e.error):t.html(e.html)},_testConnection:function(){var e=d(this).data("account"),t=d(this).data("service");d(this).text(cp_services.testing_connection),y.ajaxCall({action:"cppro_test_connection",account:e,style_id:d("#cp_style_id").val(),service:t,addon_security:cpAddonModules.ajax_nonce},y._testComplete)},_testComplete:function(e){test_conn_btn.text(cp_services.tested),setTimeout(function(){test_conn_btn.text(cp_services.test_conn_title)},1200)}});d(function(){y.init()})}(jQuery),function(i){ConvertPlugServicesTrigger={triggerHook:function(e,t){i("body").trigger("cp-services-trigger."+e,t)},addHook:function(e,t){i("body").on("cp-services-trigger."+e,t)},removeHook:function(e){i("body").off("cp-services-trigger."+e)}}}(jQuery);